<script setup lang="ts">
import type { NavigationMenuItem } from '@nuxt/ui'

const route = useRoute()
const toast = useToast()

const open = ref(false)

const links = [[{
	label: 'Overview',
	icon: 'i-lucide-activity',
	to: '/dashboard',
	onSelect: () => {
		open.value = false
	},
	active: route.path.includes('/dashboard') && route.path.split('/').length === 3
}, {
	label: 'Characters',
	icon: 'i-lucide-inbox',
	to: '/inbox',
	badge: '4',
	onSelect: () => {
		open.value = false
	}
}, {
	label: 'Customers',
	icon: 'i-lucide-users',
	to: '/customers',
	onSelect: () => {
		open.value = false
	}
}, {
	label: 'Settings',
	to: '/settings',
	icon: 'i-lucide-settings',
	defaultOpen: true,
	type: 'trigger',
	children: [{
		label: 'General',
		to: '/settings',
		exact: true,
		onSelect: () => {
			open.value = false
		}
	}, {
		label: 'Members',
		to: '/settings/members',
		onSelect: () => {
			open.value = false
		}
	}, {
		label: 'Notifications',
		to: '/settings/notifications',
		onSelect: () => {
			open.value = false
		}
	}, {
		label: 'Security',
		to: '/settings/security',
		onSelect: () => {
			open.value = false
		}
	}]
}], [{
	label: 'Github',
	icon: 'i-lucide-github',
	to: 'https://github.com/g3ru1a/forkedtowerui',
	target: '_blank'
}, {
	label: 'Help & Support',
	icon: 'i-lucide-info',
	to: 'https://discord.gg/forkedtower',
	target: '_blank'
}]] satisfies NavigationMenuItem[][]

const groups = computed(() => [{
	id: 'links',
	label: 'Go to',
	items: links.flat()
}, {
	id: 'code',
	label: 'Code',
	items: [{
		id: 'source',
		label: 'View page source',
		icon: 'i-simple-icons-github',
		to: `https://github.com/nuxt-ui-templates/dashboard/blob/main/app/pages${route.path === '/' ? '/index' : route.path}.vue`,
		target: '_blank'
	}]
}])

onMounted(async () => {
	const cookie = useCookie('cookie-consent')
	if (cookie.value === 'accepted') {
		return
	}

	toast.add({
		title: 'We use first-party cookies to enhance your experience on our website.',
		duration: 0,
		close: false,
		actions: [{
			label: 'Accept',
			color: 'neutral',
			variant: 'outline',
			onClick: () => {
				cookie.value = 'accepted'
			}
		}, {
			label: 'Opt out',
			color: 'neutral',
			variant: 'ghost'
		}]
	})
})
</script>

<template>
	<UDashboardGroup unit="rem">
		<UDashboardSidebar
			id="default"
			v-model:open="open"
			collapsible
			resizable
			class="bg-elevated/25"
			:ui="{ footer: 'lg:border-t lg:border-default p-0' }"
		>
			<template #header="{ collapsed }">
				<GroupsMenu :collapsed="collapsed" />
			</template>

			<template #default="{ collapsed }">
				<USeparator />
				<UNavigationMenu
					:collapsed="collapsed"
					:items="links[0]"
					orientation="vertical"
					tooltip
					popover
				/>

				<UNavigationMenu
					:collapsed="collapsed"
					:items="links[1]"
					orientation="vertical"
					tooltip
					class="mt-auto"
				/>
			</template>

			<template #footer="{ collapsed }">
				<UserMenu :collapsed="collapsed" :stretch="true" class="w-full"/>
			</template>
		</UDashboardSidebar>

		<UDashboardSearch :groups="groups" />

		<slot />
	</UDashboardGroup>
</template>